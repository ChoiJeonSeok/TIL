# TCP/UDP

## TCP (Transmission Control Protocol)
- **연결 지향적 프로토콜**: TCP는 신뢰성 있는 통신을 위해 먼저 연결을 설정하고 데이터를 전송합니다. 연결이 확립되면, 데이터의 순서와 신뢰성이 보장된다.
- **데이터의 신뢰성 보장**: TCP는 데이터의 손실, 오류, 중복 전송을 방지합니다. 패킷이 손실되거나 오류가 발생하면 재전송을 요청한다.
- **혼잡 제어 및 흐름 제어 기능**: 네트워크 혼잡 상태를 관리하고, 데이터 전송 속도를 조절하여 안정적인 데이터 전송을 유지한다.
- **대량의 데이터 전송에 적합**: TCP는 데이터의 순서와 무결성을 중시하므로, 대용량 데이터 전송에 적합하다.
- **예시**: 웹 페이지 로딩이나 파일 다운로드 시, TCP는 전송된 파일이 완전하고 정확한 순서대로 도착하도록 보장한다.

### **3-way handshaking을 통한 연결 설정**: 
![image](https://github.com/ChoiJeonSeok/TIL/assets/82266289/d9e9d20b-0ccb-4093-a3dd-4a1848d164f2)

- 클라이언트와 서버 간에 연결을 시작할 때, TCP는 SYN, SYN-ACK, ACK 패킷을 주고받으며 연결을 확립한다.
1. SYN 패킷 전송: 클라이언트는 서버로 SYN 패킷을 보내 연결을 요청한다. 이 패킷에는 클라이언트가 선택한 초기 시퀀스 번호가 포함된다.
2. SYN-ACK 패킷 전송: 서버는 SYN 요청을 받고, 클라이언트에게 SYN-ACK 패킷을 보낸다. 이 패킷에는 서버의 초기 시퀀스 번호와 클라이언트의 시퀀스 번호에 1을 더한 값이 포함된다.
3. ACK 패킷 전송: 클라이언트는 서버의 SYN-ACK에 대한 응답으로 ACK 패킷을 보낸다. 이 패킷에는 서버의 시퀀스 번호에 1을 더한 값이 포함된다.

### **4-way handshaking 연결 종료**: 
![image](https://github.com/ChoiJeonSeok/TIL/assets/82266289/746d604e-cece-4a79-9fed-71a772d36827)
- 연결 종료 시, TCP는 FIN, ACK, FIN, ACK의 순서로 패킷을 주고받으며 연결을 안전하게 종료한다. 이 과정에서 클라이언트는 서버로부터의 마지막 ACK 응답을 기다리는 TIME-WAIT 상태를 거친다.

1. 클라이언트의 FIN 패킷 전송: 클라이언트는 서버에게 연결 종료를 원한다는 FIN 패킷을 보낸다.
2. 서버의 ACK 패킷 응답: 서버는 FIN 패킷을 받고, ACK 패킷으로 응답한다. 이 시점에서 클라이언트는 FIN-WAIT 상태로 전환된다.
3. 서버의 FIN 패킷 전송: 서버가 준비되면, 클라이언트에게 FIN 패킷을 보내 연결 종료를 요청한다.
4. 클라이언트의 ACK 패킷 응답: 클라이언트는 서버의 FIN 패킷에 대해 ACK 패킷으로 응답하고, TIME-WAIT 상태로 들어간다. 일정 시간 후, 클라이언트는 연결을 완전히 종료한다.


## UDP (User Datagram Protocol)
- **비연결형 프로토콜**: UDP는 연결을 설정하지 않고 데이터를 전송한다. 이러한 특성은 빠른 데이터 전송을 가능하게 하지만, TCP보다 신뢰성은 낮다.
- **신속한 데이터 전송, 신뢰성은 TCP보다 낮음**: UDP는 빠른 데이터 전송을 제공하지만, 손실된 데이터의 재전송이나 순서 보장을 하지 않는다.
- **헤더 오버헤드가 낮음**: UDP는 간단한 헤더 구조를 가지고 있어, 전체적인 데이터 전송 효율이 높다.
- **신뢰성 낮음, 효율성 높음**: UDP는 패킷 손실이나 순서 변경에 대한 처리 없이 데이터를 빠르게 전송하므로 신뢰성은 낮지만 효율성은 높다.
- **실시간 통신에 적합**: UDP의 빠른 데이터 전송 특성은 실시간 스트리밍이나 온라인 게임과 같은 실시간 서비스에 적합하다.
- **데이터 전송 방식**: 
   - **연결 설정 없음**: UDP는 연결 설정 과정이 없어 데이터 전송이 빠르다.
   - **독립적인 데이터 패킷 전송**: UDP는 각각의 데이터 패킷을 독립적으로 전송하며, 전송 순서가 보장되지 않는다.
- **작은 데이터 패킷 전송에 적합**: 간단한 요청/응답 패턴이나 작은 데이터 패킷 전송에 적합하다.

**예시**: 
- 온라인 게임에서 UDP는 게임 상태를 빠르게 업데이트합니다. 일부 패킷 손실은 게임 플레이에 큰 영향을 주지 않는다.
- 실시간 스트리밍에서는 프레임의 손실이 발생해도 전체 스트리밍에 큰 문제가 되지 않으므로 UDP가 사용된다. 


## 데이터 전송과정
### TCP 데이터 전송 과정
1. **연결 설정 (3-way Handshaking)**
   - 클라이언트가 서버에 SYN 패킷을 보내 연결 요청 후 SYN_SENT 상태로 대기(무작위 숫자. 예시 30)
   - 서버는 상태를 SYN_RECEIVED로 변경하고 SYN-ACK 패킷으로 응답(무작위 숫자와 클라이언트가 보낸 SYN+1. 예시 50 31)
   - 클라이언트는 상태를 ESTABLISHED로 변경하고 ACK 패킷으로 최종 응답하여 연결 확립(서버가 보낸 SYN+1 예시 51)
   - 서버도 ESTABLISHED 상태로 변경됨.

2. **데이터 전송**
   - 데이터 패킷이 순차적으로 전송
   - 각 패킷에 대해 수신 측은 ACK 패킷으로 응답하여 전송 확인

3. **혼잡 제어 및 흐름 제어**
   - 네트워크 상태와 수신 측의 데이터 처리 능력에 따라 전송 속도 조절

4. **연결 종료 (4-way Handshaking)**
   - 연결 종료 요청을 위해 클라이언트가 FIN 패킷 전송. FIN-WAIT-1 상태로 대기
   - 서버는 상태를 CLOSE-WAIT으로 바꾸고 응답 ACK 패킷으로 응답. 해당 포트에 연결된 애플리케이션에서 close를 요청
   - 클라이언트는 상태를 FIN-WAIT-2로 변경
   - 서버 애플리케이션은 종료 프로세스를 진행. 클라이언트로 FIN 패킷을 보내고 상태를 LAST-ACK으로 변경
   - 클라이언트가 ACK로 응답하고 전송 실패에 대비하여 TIME-WAIT으로 상태를 변경. 일정 시간 후 연결 종료

### UDP 데이터 전송 과정
1. **연결 설정 없음**
   - UDP는 연결 설정 과정 없이 바로 데이터를 전송

2. **데이터 전송**
   - 독립적인 데이터 패킷이 순차적이지 않게 전송
   - 각 패킷은 독립적으로 처리되며 전송 순서 보장되지 않음

3. **헤더 오버헤드가 낮음**
   - UDP 헤더는 간단하므로 전체적인 데이터 전송 효율이 높음

4. **신뢰성 낮고 효율성 높음**
   - 패킷 손실이나 순서 변경에 대한 처리 없이 빠르게 전송
